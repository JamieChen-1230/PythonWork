-- -----------------創建外鍵-----------------
--每一個班主任會對應多個學生,而每個學生只能對應一個班主任
--主表(被綁定的表)
CREATE  TABLE ClassCharger(
       id TINYINT PRIMARY KEY auto_increment,
       name VARCHAR (20),
       age INT ,
       is_marriged boolean
);
INSERT INTO ClassCharger (name,age,is_marriged) VALUES ("冰冰", 12 , 0 ),
                                                       ("丹丹", 14 , 0 ),
                                                       ("歪歪", 22 , 0 ),
                                                       ("姍姍", 20 , 0 ),
                                                       ("小雨", 21 , 0 );

--子表(去綁定別人的表)
--切記:作為外鍵一定要和關聯主鍵的數據類型保持一致
--若兩張表有關聯就無法隨意刪主表數據，要刪之前須把子表內相關連結數據給刪除
CREATE TABLE Student(
       id INT PRIMARY KEY auto_increment,
       name VARCHAR (20),
       charger_id TINYINT,
       foreign key (charger_id) references classcharger(id)
)ENGINE=INNODB;
-- [ADD CONSTRAINT charger_fk_stu] FOREIGN KEY (charger_id) REFERENCES ClassCharger(id)
--括弧起來的是外鍵名稱可加可不加，不加會給予默認名稱
INSERT INTO Student(name,charger_id) VALUES ("alvin1", 2 ),
                                            ("alvin2", 4 ),
                                            ("alvin3", 1 ),
                                            ("alvin4", 3 ),
                                            ("alvin5", 1 ),
                                            ("alvin6", 3 ),
                                            ("alvin7", 2 );

--增加外鍵(abc為外鍵名)
ALTER TABLE student ADD CONSTRAINT abc
                    FOREIGN KEY (charger_id)
                    REFERENCES classcharger(id);
--刪除外鍵
ALTER TABLE student DROP FOREIGN KEY abc;


-- 外鍵約束對子表的含義:如果在父表中找不到候選鍵,則不允許在子表上進行insert/update
-- 外鍵約束對父表的含義:
    --在父表上進行update/delete以更新或刪除在子表中有一條或多條對應匹配行的候選鍵時,
    --父表的行為取決於：在定義子表的外鍵時指定的on update/on delete子句

-- -----------innodb支持的四種方式-----------
--cascade方式在父表上update/delete記錄時，同步update/delete掉子表的匹配記錄
--外鍵的級聯刪除：如果父表中的記錄被刪除，則子表中對應的記錄自動被刪除--------
--FOREIGN KEY (charger_id) REFERENCES ClassCharger(id) ON DELETE CASCADE
CREATE TABLE Student(
       id INT PRIMARY KEY auto_increment,
       name VARCHAR (20),
       charger_id TINYINT,
       FOREIGN KEY (charger_id) REFERENCES ClassCharger(id) ON DELETE CASCADE
)ENGINE=INNODB;
INSERT INTO Student(name,charger_id) VALUES ("alvin1", 2 ),
                                            ("alvin2", 4 ),
                                            ("alvin3", 5 ),
                                            ("alvin4", 3 ),
                                            ("alvin5", 5 ),
                                            ("alvin6", 3 ),
                                            ("alvin7", 2 );

--set null方式在父表上update/delete記錄時，將子表上匹配記錄的列設為null
--要注意子表的外鍵列不能為not null
--FOREIGN KEY (charger_id) REFERENCES ClassCharger(id) ON DELETE SET NULL
CREATE TABLE Student(
       id INT PRIMARY KEY auto_increment,
       name VARCHAR (20),
       charger_id TINYINT,
       FOREIGN KEY (charger_id) REFERENCES ClassCharger(id) ON DELETE SET NULL
)ENGINE=INNODB;
INSERT INTO Student(name,charger_id) VALUES ("alvin1", 2 ),
                                            ("alvin2", 4 ),
                                            ("alvin3", 5 ),
                                            ("alvin4", 3 ),
                                            ("alvin5", 5 ),
                                            ("alvin6", 3 ),
                                            ("alvin7", 2 );